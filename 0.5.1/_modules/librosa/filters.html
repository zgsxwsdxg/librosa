

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>librosa.filters &mdash; librosa 0.5.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="librosa 0.5.1 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> librosa
          

          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../core.html">Core IO and DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../display.html">Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../feature.html">Feature extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../onset.html">Onset detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beat.html">Beat and tempo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../decompose.html">Spectrogram decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../effects.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../segment.html">Temporal segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../util.html">Utilities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cache.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ioformats.html">Advanced I/O Use Cases</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">librosa</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>librosa.filters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for librosa.filters</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Filters</span>
<span class="sd">=======</span>

<span class="sd">Filter bank construction</span>
<span class="sd">------------------------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    dct</span>
<span class="sd">    mel</span>
<span class="sd">    chroma</span>
<span class="sd">    constant_q</span>

<span class="sd">Window functions</span>
<span class="sd">----------------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    window_bandwidth</span>
<span class="sd">    get_window</span>


<span class="sd">Miscellaneous</span>
<span class="sd">-------------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    constant_q_lengths</span>
<span class="sd">    cq_to_chroma</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">cache</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">.util.exceptions</span> <span class="k">import</span> <span class="n">ParameterError</span>

<span class="kn">from</span> <span class="nn">.core.time_frequency</span> <span class="k">import</span> <span class="n">note_to_hz</span><span class="p">,</span> <span class="n">hz_to_midi</span><span class="p">,</span> <span class="n">hz_to_octs</span>
<span class="kn">from</span> <span class="nn">.core.time_frequency</span> <span class="k">import</span> <span class="n">fft_frequencies</span><span class="p">,</span> <span class="n">mel_frequencies</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dct&#39;</span><span class="p">,</span>
           <span class="s1">&#39;mel&#39;</span><span class="p">,</span>
           <span class="s1">&#39;chroma&#39;</span><span class="p">,</span>
           <span class="s1">&#39;constant_q&#39;</span><span class="p">,</span>
           <span class="s1">&#39;constant_q_lengths&#39;</span><span class="p">,</span>
           <span class="s1">&#39;cq_to_chroma&#39;</span><span class="p">,</span>
           <span class="s1">&#39;window_bandwidth&#39;</span><span class="p">,</span>
           <span class="s1">&#39;get_window&#39;</span><span class="p">]</span>


<span class="c1"># Dictionary of window function bandwidths</span>

<span class="n">WINDOW_BANDWIDTHS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bart&#39;</span><span class="p">:</span> <span class="mf">1.3334961334912805</span><span class="p">,</span>
                     <span class="s1">&#39;barthann&#39;</span><span class="p">:</span> <span class="mf">1.4560255965133932</span><span class="p">,</span>
                     <span class="s1">&#39;bartlett&#39;</span><span class="p">:</span> <span class="mf">1.3334961334912805</span><span class="p">,</span>
                     <span class="s1">&#39;bkh&#39;</span><span class="p">:</span> <span class="mf">2.0045975283585014</span><span class="p">,</span>
                     <span class="s1">&#39;black&#39;</span><span class="p">:</span> <span class="mf">1.7269681554262326</span><span class="p">,</span>
                     <span class="s1">&#39;blackharr&#39;</span><span class="p">:</span> <span class="mf">2.0045975283585014</span><span class="p">,</span>
                     <span class="s1">&#39;blackman&#39;</span><span class="p">:</span> <span class="mf">1.7269681554262326</span><span class="p">,</span>
                     <span class="s1">&#39;blackmanharris&#39;</span><span class="p">:</span> <span class="mf">2.0045975283585014</span><span class="p">,</span>
                     <span class="s1">&#39;blk&#39;</span><span class="p">:</span> <span class="mf">1.7269681554262326</span><span class="p">,</span>
                     <span class="s1">&#39;bman&#39;</span><span class="p">:</span> <span class="mf">1.7859588613860062</span><span class="p">,</span>
                     <span class="s1">&#39;bmn&#39;</span><span class="p">:</span> <span class="mf">1.7859588613860062</span><span class="p">,</span>
                     <span class="s1">&#39;bohman&#39;</span><span class="p">:</span> <span class="mf">1.7859588613860062</span><span class="p">,</span>
                     <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                     <span class="s1">&#39;boxcar&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                     <span class="s1">&#39;brt&#39;</span><span class="p">:</span> <span class="mf">1.3334961334912805</span><span class="p">,</span>
                     <span class="s1">&#39;brthan&#39;</span><span class="p">:</span> <span class="mf">1.4560255965133932</span><span class="p">,</span>
                     <span class="s1">&#39;bth&#39;</span><span class="p">:</span> <span class="mf">1.4560255965133932</span><span class="p">,</span>
                     <span class="s1">&#39;cosine&#39;</span><span class="p">:</span> <span class="mf">1.2337005350199792</span><span class="p">,</span>
                     <span class="s1">&#39;flat&#39;</span><span class="p">:</span> <span class="mf">2.7762255046484143</span><span class="p">,</span>
                     <span class="s1">&#39;flattop&#39;</span><span class="p">:</span> <span class="mf">2.7762255046484143</span><span class="p">,</span>
                     <span class="s1">&#39;flt&#39;</span><span class="p">:</span> <span class="mf">2.7762255046484143</span><span class="p">,</span>
                     <span class="s1">&#39;halfcosine&#39;</span><span class="p">:</span> <span class="mf">1.2337005350199792</span><span class="p">,</span>
                     <span class="s1">&#39;ham&#39;</span><span class="p">:</span> <span class="mf">1.3629455320350348</span><span class="p">,</span>
                     <span class="s1">&#39;hamm&#39;</span><span class="p">:</span> <span class="mf">1.3629455320350348</span><span class="p">,</span>
                     <span class="s1">&#39;hamming&#39;</span><span class="p">:</span> <span class="mf">1.3629455320350348</span><span class="p">,</span>
                     <span class="s1">&#39;han&#39;</span><span class="p">:</span> <span class="mf">1.50018310546875</span><span class="p">,</span>
                     <span class="s1">&#39;hann&#39;</span><span class="p">:</span> <span class="mf">1.50018310546875</span><span class="p">,</span>
                     <span class="s1">&#39;hanning&#39;</span><span class="p">:</span> <span class="mf">1.50018310546875</span><span class="p">,</span>
                     <span class="s1">&#39;nut&#39;</span><span class="p">:</span> <span class="mf">1.9763500280946082</span><span class="p">,</span>
                     <span class="s1">&#39;nutl&#39;</span><span class="p">:</span> <span class="mf">1.9763500280946082</span><span class="p">,</span>
                     <span class="s1">&#39;nuttall&#39;</span><span class="p">:</span> <span class="mf">1.9763500280946082</span><span class="p">,</span>
                     <span class="s1">&#39;ones&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                     <span class="s1">&#39;par&#39;</span><span class="p">:</span> <span class="mf">1.9174603174603191</span><span class="p">,</span>
                     <span class="s1">&#39;parz&#39;</span><span class="p">:</span> <span class="mf">1.9174603174603191</span><span class="p">,</span>
                     <span class="s1">&#39;parzen&#39;</span><span class="p">:</span> <span class="mf">1.9174603174603191</span><span class="p">,</span>
                     <span class="s1">&#39;rect&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                     <span class="s1">&#39;rectangular&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                     <span class="s1">&#39;tri&#39;</span><span class="p">:</span> <span class="mf">1.3331706523555851</span><span class="p">,</span>
                     <span class="s1">&#39;triang&#39;</span><span class="p">:</span> <span class="mf">1.3331706523555851</span><span class="p">,</span>
                     <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="mf">1.3331706523555851</span><span class="p">}</span>


<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="dct"><a class="viewcode-back" href="../../generated/librosa.filters.dct.html#librosa.filters.dct">[docs]</a><span class="k">def</span> <span class="nf">dct</span><span class="p">(</span><span class="n">n_filters</span><span class="p">,</span> <span class="n">n_input</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Discrete cosine transform (DCT type-III) basis.</span>

<span class="sd">    .. [1] http://en.wikipedia.org/wiki/Discrete_cosine_transform</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_filters : int &gt; 0 [scalar]</span>
<span class="sd">        number of output components (DCT filters)</span>

<span class="sd">    n_input : int &gt; 0 [scalar]</span>
<span class="sd">        number of input components (frequency bins)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dct_basis: np.ndarray [shape=(n_filters, n_input)]</span>
<span class="sd">        DCT (type-III) basis vectors [1]_</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; n_fft = 2048</span>
<span class="sd">    &gt;&gt;&gt; dct_filters = librosa.filters.dct(13, 1 + n_fft // 2)</span>
<span class="sd">    &gt;&gt;&gt; dct_filters</span>
<span class="sd">    array([[ 0.031,  0.031, ...,  0.031,  0.031],</span>
<span class="sd">           [ 0.044,  0.044, ..., -0.044, -0.044],</span>
<span class="sd">           ...,</span>
<span class="sd">           [ 0.044,  0.044, ..., -0.044, -0.044],</span>
<span class="sd">           [ 0.044,  0.044, ...,  0.044,  0.044]])</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; plt.figure()</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(dct_filters, x_axis=&#39;linear&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.ylabel(&#39;DCT function&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&#39;DCT filter bank&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.colorbar()</span>
<span class="sd">    &gt;&gt;&gt; plt.tight_layout()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">basis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_filters</span><span class="p">,</span> <span class="n">n_input</span><span class="p">))</span>
    <span class="n">basis</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_input</span><span class="p">)</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n_input</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">n_input</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_filters</span><span class="p">):</span>
        <span class="n">basis</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">samples</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">n_input</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">basis</span></div>


<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="mel"><a class="viewcode-back" href="../../generated/librosa.filters.mel.html#librosa.filters.mel">[docs]</a><span class="k">def</span> <span class="nf">mel</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">n_fft</span><span class="p">,</span> <span class="n">n_mels</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">htk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a Filterbank matrix to combine FFT bins into Mel-frequency bins</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sr        : number &gt; 0 [scalar]</span>
<span class="sd">        sampling rate of the incoming signal</span>

<span class="sd">    n_fft     : int &gt; 0 [scalar]</span>
<span class="sd">        number of FFT components</span>

<span class="sd">    n_mels    : int &gt; 0 [scalar]</span>
<span class="sd">        number of Mel bands to generate</span>

<span class="sd">    fmin      : float &gt;= 0 [scalar]</span>
<span class="sd">        lowest frequency (in Hz)</span>

<span class="sd">    fmax      : float &gt;= 0 [scalar]</span>
<span class="sd">        highest frequency (in Hz).</span>
<span class="sd">        If `None`, use `fmax = sr / 2.0`</span>

<span class="sd">    htk       : bool [scalar]</span>
<span class="sd">        use HTK formula instead of Slaney</span>

<span class="sd">    norm : {None, 1, np.inf} [scalar]</span>
<span class="sd">        if 1, divide the triangular mel weights by the width of the mel band </span>
<span class="sd">        (area normalization).  Otherwise, leave all the triangles aiming for </span>
<span class="sd">        a peak value of 1.0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    M         : np.ndarray [shape=(n_mels, 1 + n_fft/2)]</span>
<span class="sd">        Mel transform matrix</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; melfb = librosa.filters.mel(22050, 2048)</span>
<span class="sd">    &gt;&gt;&gt; melfb</span>
<span class="sd">    array([[ 0.   ,  0.016, ...,  0.   ,  0.   ],</span>
<span class="sd">           [ 0.   ,  0.   , ...,  0.   ,  0.   ],</span>
<span class="sd">           ...,</span>
<span class="sd">           [ 0.   ,  0.   , ...,  0.   ,  0.   ],</span>
<span class="sd">           [ 0.   ,  0.   , ...,  0.   ,  0.   ]])</span>


<span class="sd">    Clip the maximum frequency to 8KHz</span>

<span class="sd">    &gt;&gt;&gt; librosa.filters.mel(22050, 2048, fmax=8000)</span>
<span class="sd">    array([[ 0.  ,  0.02, ...,  0.  ,  0.  ],</span>
<span class="sd">           [ 0.  ,  0.  , ...,  0.  ,  0.  ],</span>
<span class="sd">           ...,</span>
<span class="sd">           [ 0.  ,  0.  , ...,  0.  ,  0.  ],</span>
<span class="sd">           [ 0.  ,  0.  , ...,  0.  ,  0.  ]])</span>


<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; plt.figure()</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(melfb, x_axis=&#39;linear&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.ylabel(&#39;Mel filter&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&#39;Mel filter bank&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.colorbar()</span>
<span class="sd">    &gt;&gt;&gt; plt.tight_layout()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">norm</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">norm</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Unsupported norm: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">norm</span><span class="p">)))</span>

    <span class="c1"># Initialize the weights</span>
    <span class="n">n_mels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_mels</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_mels</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">n_fft</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)))</span>

    <span class="c1"># Center freqs of each FFT bin</span>
    <span class="n">fftfreqs</span> <span class="o">=</span> <span class="n">fft_frequencies</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">)</span>

    <span class="c1"># &#39;Center freqs&#39; of mel bands - uniformly spaced between limits</span>
    <span class="n">mel_f</span> <span class="o">=</span> <span class="n">mel_frequencies</span><span class="p">(</span><span class="n">n_mels</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">htk</span><span class="o">=</span><span class="n">htk</span><span class="p">)</span>

    <span class="n">fdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">mel_f</span><span class="p">)</span>
    <span class="n">ramps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">mel_f</span><span class="p">,</span> <span class="n">fftfreqs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mels</span><span class="p">):</span>
        <span class="c1"># lower and upper slopes for all bins</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="o">-</span><span class="n">ramps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">fdiff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">ramps</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">fdiff</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># .. then intersect them with each other and zero</span>
        <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Slaney-style mel is scaled to be approx constant energy per channel</span>
        <span class="n">enorm</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">mel_f</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">n_mels</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">mel_f</span><span class="p">[:</span><span class="n">n_mels</span><span class="p">])</span>
        <span class="n">weights</span> <span class="o">*=</span> <span class="n">enorm</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="c1"># Only check weights if f_mel[0] is positive</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">mel_f</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="c1"># This means we have an empty channel somewhere</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Empty filters detected in mel frequency basis. &#39;</span>
                      <span class="s1">&#39;Some channels will produce empty responses. &#39;</span>
                      <span class="s1">&#39;Try increasing your sampling rate (and fmax) or &#39;</span>
                      <span class="s1">&#39;reducing n_mels.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">weights</span></div>


<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="chroma"><a class="viewcode-back" href="../../generated/librosa.filters.chroma.html#librosa.filters.chroma">[docs]</a><span class="k">def</span> <span class="nf">chroma</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">n_fft</span><span class="p">,</span> <span class="n">n_chroma</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">A440</span><span class="o">=</span><span class="mf">440.0</span><span class="p">,</span> <span class="n">ctroct</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
           <span class="n">octwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">base_c</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a Filterbank matrix to convert STFT to chroma</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sr        : number &gt; 0 [scalar]</span>
<span class="sd">        audio sampling rate</span>

<span class="sd">    n_fft     : int &gt; 0 [scalar]</span>
<span class="sd">        number of FFT bins</span>

<span class="sd">    n_chroma  : int &gt; 0 [scalar]</span>
<span class="sd">        number of chroma bins</span>

<span class="sd">    A440      : float &gt; 0 [scalar]</span>
<span class="sd">        Reference frequency for A440</span>

<span class="sd">    ctroct    : float &gt; 0 [scalar]</span>

<span class="sd">    octwidth  : float &gt; 0 or None [scalar]</span>
<span class="sd">        `ctroct` and `octwidth` specify a dominance window -</span>
<span class="sd">        a Gaussian weighting centered on `ctroct` (in octs, A0 = 27.5Hz)</span>
<span class="sd">        and with a gaussian half-width of `octwidth`.</span>
<span class="sd">        Set `octwidth` to `None` to use a flat weighting.</span>

<span class="sd">    norm : float &gt; 0 or np.inf</span>
<span class="sd">        Normalization factor for each filter</span>

<span class="sd">    base_c : bool</span>
<span class="sd">        If True, the filter bank will start at &#39;C&#39;.</span>
<span class="sd">        If False, the filter bank will start at &#39;A&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wts : ndarray [shape=(n_chroma, 1 + n_fft / 2)]</span>
<span class="sd">        Chroma filter matrix</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    util.normalize</span>
<span class="sd">    feature.chroma_stft</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Build a simple chroma filter bank</span>

<span class="sd">    &gt;&gt;&gt; chromafb = librosa.filters.chroma(22050, 4096)</span>
<span class="sd">    array([[  1.689e-05,   3.024e-04, ...,   4.639e-17,   5.327e-17],</span>
<span class="sd">           [  1.716e-05,   2.652e-04, ...,   2.674e-25,   3.176e-25],</span>
<span class="sd">    ...,</span>
<span class="sd">           [  1.578e-05,   3.619e-04, ...,   8.577e-06,   9.205e-06],</span>
<span class="sd">           [  1.643e-05,   3.355e-04, ...,   1.474e-10,   1.636e-10]])</span>

<span class="sd">    Use quarter-tones instead of semitones</span>

<span class="sd">    &gt;&gt;&gt; librosa.filters.chroma(22050, 4096, n_chroma=24)</span>
<span class="sd">    array([[  1.194e-05,   2.138e-04, ...,   6.297e-64,   1.115e-63],</span>
<span class="sd">           [  1.206e-05,   2.009e-04, ...,   1.546e-79,   2.929e-79],</span>
<span class="sd">    ...,</span>
<span class="sd">           [  1.162e-05,   2.372e-04, ...,   6.417e-38,   9.923e-38],</span>
<span class="sd">           [  1.180e-05,   2.260e-04, ...,   4.697e-50,   7.772e-50]])</span>


<span class="sd">    Equally weight all octaves</span>

<span class="sd">    &gt;&gt;&gt; librosa.filters.chroma(22050, 4096, octwidth=None)</span>
<span class="sd">    array([[  3.036e-01,   2.604e-01, ...,   2.445e-16,   2.809e-16],</span>
<span class="sd">           [  3.084e-01,   2.283e-01, ...,   1.409e-24,   1.675e-24],</span>
<span class="sd">    ...,</span>
<span class="sd">           [  2.836e-01,   3.116e-01, ...,   4.520e-05,   4.854e-05],</span>
<span class="sd">           [  2.953e-01,   2.888e-01, ...,   7.768e-10,   8.629e-10]])</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; plt.figure()</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(chromafb, x_axis=&#39;linear&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.ylabel(&#39;Chroma filter&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&#39;Chroma filter bank&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.colorbar()</span>
<span class="sd">    &gt;&gt;&gt; plt.tight_layout()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_chroma</span><span class="p">,</span> <span class="n">n_fft</span><span class="p">))</span>

    <span class="c1"># Get the FFT bins, not counting the DC component</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n_fft</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">frqbins</span> <span class="o">=</span> <span class="n">n_chroma</span> <span class="o">*</span> <span class="n">hz_to_octs</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">A440</span><span class="p">)</span>

    <span class="c1"># make up a value for the 0 Hz bin = 1.5 octaves below bin 1</span>
    <span class="c1"># (so chroma is 50% rotated from bin 1, and bin width is broad)</span>
    <span class="n">frqbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="n">frqbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">n_chroma</span><span class="p">],</span> <span class="n">frqbins</span><span class="p">))</span>

    <span class="n">binwidthbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frqbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">frqbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                              <span class="mf">1.0</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">frqbins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_chroma</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

    <span class="n">n_chroma2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n_chroma</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Project into range -n_chroma/2 .. n_chroma/2</span>
    <span class="c1"># add on fixed offset of 10*n_chroma to ensure all values passed to</span>
    <span class="c1"># rem are positive</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="n">n_chroma2</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">n_chroma</span><span class="p">,</span> <span class="n">n_chroma</span><span class="p">)</span> <span class="o">-</span> <span class="n">n_chroma2</span>

    <span class="c1"># Gaussian bumps - 2*D to make them narrower</span>
    <span class="n">wts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">D</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">binwidthbins</span><span class="p">,</span> <span class="p">(</span><span class="n">n_chroma</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># normalize each column</span>
    <span class="n">wts</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">wts</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Maybe apply scaling for fft bins</span>
    <span class="k">if</span> <span class="n">octwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wts</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">frqbins</span><span class="o">/</span><span class="n">n_chroma</span> <span class="o">-</span> <span class="n">ctroct</span><span class="p">)</span><span class="o">/</span><span class="n">octwidth</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">n_chroma</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">base_c</span><span class="p">:</span>
        <span class="n">wts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">wts</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># remove aliasing columns, copy to ensure row-contiguity</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">wts</span><span class="p">[:,</span> <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">n_fft</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span></div>


<span class="k">def</span> <span class="nf">__float_window</span><span class="p">(</span><span class="n">window_spec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Decorator function for windows with fractional input.</span>

<span class="sd">    This function guarantees that for fractional `x`, the following hold:</span>

<span class="sd">    1. `__float_window(window_function)(x)` has length `np.ceil(x)`</span>
<span class="sd">    2. all values from `np.floor(x)` are set to 0.</span>

<span class="sd">    For integer-valued `x`, there should be no change in behavior.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_wrap</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The wrapped window&#39;&#39;&#39;</span>
        <span class="n">n_min</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

        <span class="n">window</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">window_spec</span><span class="p">,</span> <span class="n">n_min</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_max</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">))],</span>
                            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>

        <span class="n">window</span><span class="p">[</span><span class="n">n_min</span><span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">window</span>

    <span class="k">return</span> <span class="n">_wrap</span>


<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="constant_q"><a class="viewcode-back" href="../../generated/librosa.filters.constant_q.html#librosa.filters.constant_q">[docs]</a><span class="k">def</span> <span class="nf">constant_q</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span> <span class="n">bins_per_octave</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">tuning</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
               <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hann&#39;</span><span class="p">,</span> <span class="n">filter_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pad_fft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Construct a constant-Q basis.</span>

<span class="sd">    This uses the filter bank described by [1]_.</span>

<span class="sd">    .. [1] McVicar, Matthew.</span>
<span class="sd">            &quot;A machine learning approach to automatic chord extraction.&quot;</span>
<span class="sd">            Dissertation, University of Bristol. 2013.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        Audio sampling rate</span>

<span class="sd">    fmin : float &gt; 0 [scalar]</span>
<span class="sd">        Minimum frequency bin. Defaults to `C1 ~= 32.70`</span>

<span class="sd">    n_bins : int &gt; 0 [scalar]</span>
<span class="sd">        Number of frequencies.  Defaults to 7 octaves (84 bins).</span>

<span class="sd">    bins_per_octave : int &gt; 0 [scalar]</span>
<span class="sd">        Number of bins per octave</span>

<span class="sd">    tuning : float in `[-0.5, +0.5)` [scalar]</span>
<span class="sd">        Tuning deviation from A440 in fractions of a bin</span>

<span class="sd">    window : string, tuple, number, or function</span>
<span class="sd">        Windowing function to apply to filters.</span>

<span class="sd">    filter_scale : float &gt; 0 [scalar]</span>
<span class="sd">        Scale of filter windows.</span>
<span class="sd">        Small values (&lt;1) use shorter windows for higher temporal resolution.</span>

<span class="sd">    pad_fft : boolean</span>
<span class="sd">        Center-pad all filters up to the nearest integral power of 2.</span>

<span class="sd">        By default, padding is done with zeros, but this can be overridden</span>
<span class="sd">        by setting the `mode=` field in *kwargs*.</span>

<span class="sd">    norm : {inf, -inf, 0, float &gt; 0}</span>
<span class="sd">        Type of norm to use for basis function normalization.</span>
<span class="sd">        See librosa.util.normalize</span>

<span class="sd">    kwargs : additional keyword arguments</span>
<span class="sd">        Arguments to `np.pad()` when `pad==True`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filters : np.ndarray, `len(filters) == n_bins`</span>
<span class="sd">        `filters[i]` is `i`\ th time-domain CQT basis filter</span>

<span class="sd">    lengths : np.ndarray, `len(lengths) == n_bins`</span>
<span class="sd">        The (fractional) length of each filter</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    constant_q_lengths</span>
<span class="sd">    librosa.core.cqt</span>
<span class="sd">    librosa.util.normalize</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Use a shorter window for each filter</span>

<span class="sd">    &gt;&gt;&gt; basis, lengths = librosa.filters.constant_q(22050, filter_scale=0.5)</span>

<span class="sd">    Plot one octave of filters in time and frequency</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; basis, lengths = librosa.filters.constant_q(22050)</span>
<span class="sd">    &gt;&gt;&gt; plt.figure(figsize=(10, 6))</span>
<span class="sd">    &gt;&gt;&gt; plt.subplot(2, 1, 1)</span>
<span class="sd">    &gt;&gt;&gt; notes = librosa.midi_to_note(np.arange(24, 24 + len(basis)))</span>
<span class="sd">    &gt;&gt;&gt; for i, (f, n) in enumerate(zip(basis, notes[:12])):</span>
<span class="sd">    ...     f_scale = librosa.util.normalize(f) / 2</span>
<span class="sd">    ...     plt.plot(i + f_scale.real)</span>
<span class="sd">    ...     plt.plot(i + f_scale.imag, linestyle=&#39;:&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.axis(&#39;tight&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.yticks(np.arange(len(notes[:12])), notes[:12])</span>
<span class="sd">    &gt;&gt;&gt; plt.ylabel(&#39;CQ filters&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&#39;CQ filters (one octave, time domain)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.xlabel(&#39;Time (samples at 22050 Hz)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.legend([&#39;Real&#39;, &#39;Imaginary&#39;], frameon=True, framealpha=0.8)</span>
<span class="sd">    &gt;&gt;&gt; plt.subplot(2, 1, 2)</span>
<span class="sd">    &gt;&gt;&gt; F = np.abs(np.fft.fftn(basis, axes=[-1]))</span>
<span class="sd">    &gt;&gt;&gt; # Keep only the positive frequencies</span>
<span class="sd">    &gt;&gt;&gt; F = F[:, :(1 + F.shape[1] // 2)]</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(F, x_axis=&#39;linear&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.yticks(np.arange(len(notes))[::12], notes[::12])</span>
<span class="sd">    &gt;&gt;&gt; plt.ylabel(&#39;CQ filters&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&#39;CQ filter magnitudes (frequency domain)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.tight_layout()</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">fmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="n">note_to_hz</span><span class="p">(</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>

    <span class="c1"># Pass-through parameters to get the filter lengths</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">constant_q_lengths</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span>
                                 <span class="n">n_bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span>
                                 <span class="n">bins_per_octave</span><span class="o">=</span><span class="n">bins_per_octave</span><span class="p">,</span>
                                 <span class="n">tuning</span><span class="o">=</span><span class="n">tuning</span><span class="p">,</span>
                                 <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span>
                                 <span class="n">filter_scale</span><span class="o">=</span><span class="n">filter_scale</span><span class="p">)</span>

    <span class="c1"># Apply tuning correction</span>
    <span class="n">correction</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">**</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tuning</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">)</span>
    <span class="n">fmin</span> <span class="o">=</span> <span class="n">correction</span> <span class="o">*</span> <span class="n">fmin</span>

    <span class="c1"># Q should be capitalized here, so we suppress the name warning</span>
    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">filter_scale</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Convert lengths back to frequencies</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">sr</span> <span class="o">/</span> <span class="n">lengths</span>

    <span class="c1"># Build the filters</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ilen</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">freqs</span><span class="p">):</span>
        <span class="c1"># Build the filter: note, length will be ceil(ilen)</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ilen</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">/</span> <span class="n">sr</span><span class="p">)</span>

        <span class="c1"># Apply the windowing function</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">__float_window</span><span class="p">(</span><span class="n">window</span><span class="p">)(</span><span class="n">ilen</span><span class="p">)</span>

        <span class="c1"># Normalize</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>

    <span class="c1"># Pad and stack</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pad_fft</span><span class="p">:</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">max_len</span><span class="p">))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_len</span><span class="p">))</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">util</span><span class="o">.</span><span class="n">pad_center</span><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">filt</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">filters</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span></div>


<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="constant_q_lengths"><a class="viewcode-back" href="../../generated/librosa.filters.constant_q_lengths.html#librosa.filters.constant_q_lengths">[docs]</a><span class="k">def</span> <span class="nf">constant_q_lengths</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span> <span class="n">bins_per_octave</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                       <span class="n">tuning</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hann&#39;</span><span class="p">,</span> <span class="n">filter_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Return length of each filter in a constant-Q basis.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        Audio sampling rate</span>

<span class="sd">    fmin : float &gt; 0 [scalar]</span>
<span class="sd">        Minimum frequency bin.</span>

<span class="sd">    n_bins : int &gt; 0 [scalar]</span>
<span class="sd">        Number of frequencies.  Defaults to 7 octaves (84 bins).</span>

<span class="sd">    bins_per_octave : int &gt; 0 [scalar]</span>
<span class="sd">        Number of bins per octave</span>

<span class="sd">    tuning : float in `[-0.5, +0.5)` [scalar]</span>
<span class="sd">        Tuning deviation from A440 in fractions of a bin</span>

<span class="sd">    window : str or callable</span>
<span class="sd">        Window function to use on filters</span>

<span class="sd">    filter_scale : float &gt; 0 [scalar]</span>
<span class="sd">        Resolution of filter windows. Larger values use longer windows.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lengths : np.ndarray</span>
<span class="sd">        The length of each filter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    constant_q</span>
<span class="sd">    librosa.core.cqt</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">fmin</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;fmin must be positive&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bins_per_octave</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;bins_per_octave must be positive&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filter_scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;filter_scale must be positive&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_bins</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_bins</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;n_bins must be a positive integer&#39;</span><span class="p">)</span>

    <span class="n">correction</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">**</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tuning</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">)</span>

    <span class="n">fmin</span> <span class="o">=</span> <span class="n">correction</span> <span class="o">*</span> <span class="n">fmin</span>

    <span class="c1"># Q should be capitalized here, so we suppress the name warning</span>
    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">filter_scale</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute the frequencies</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">fmin</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">window_bandwidth</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">/</span> <span class="n">Q</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">sr</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Filter pass-band lies beyond Nyquist&#39;</span><span class="p">)</span>

    <span class="c1"># Convert frequencies to filter lengths</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">sr</span> <span class="o">/</span> <span class="n">freq</span>

    <span class="k">return</span> <span class="n">lengths</span></div>


<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="cq_to_chroma"><a class="viewcode-back" href="../../generated/librosa.filters.cq_to_chroma.html#librosa.filters.cq_to_chroma">[docs]</a><span class="k">def</span> <span class="nf">cq_to_chroma</span><span class="p">(</span><span class="n">n_input</span><span class="p">,</span> <span class="n">bins_per_octave</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">n_chroma</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_c</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert a Constant-Q basis to Chroma.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_input : int &gt; 0 [scalar]</span>
<span class="sd">        Number of input components (CQT bins)</span>

<span class="sd">    bins_per_octave : int &gt; 0 [scalar]</span>
<span class="sd">        How many bins per octave in the CQT</span>

<span class="sd">    n_chroma : int &gt; 0 [scalar]</span>
<span class="sd">        Number of output bins (per octave) in the chroma</span>

<span class="sd">    fmin : None or float &gt; 0</span>
<span class="sd">        Center frequency of the first constant-Q channel.</span>
<span class="sd">        Default: &#39;C1&#39; ~= 32.7 Hz</span>

<span class="sd">    window : None or np.ndarray</span>
<span class="sd">        If provided, the cq_to_chroma filter bank will be</span>
<span class="sd">        convolved with `window`.</span>

<span class="sd">    base_c : bool</span>
<span class="sd">        If True, the first chroma bin will start at &#39;C&#39;</span>
<span class="sd">        If False, the first chroma bin will start at &#39;A&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cq_to_chroma : np.ndarray [shape=(n_chroma, n_input)]</span>
<span class="sd">        Transformation matrix: `Chroma = np.dot(cq_to_chroma, CQT)`</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParameterError</span>
<span class="sd">        If `n_input` is not an integer multiple of `n_chroma`</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Get a CQT, and wrap bins to chroma</span>

<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.util.example_audio_file())</span>
<span class="sd">    &gt;&gt;&gt; CQT = librosa.cqt(y, sr=sr)</span>
<span class="sd">    &gt;&gt;&gt; chroma_map = librosa.filters.cq_to_chroma(CQT.shape[0])</span>
<span class="sd">    &gt;&gt;&gt; chromagram = chroma_map.dot(CQT)</span>
<span class="sd">    &gt;&gt;&gt; # Max-normalize each time step</span>
<span class="sd">    &gt;&gt;&gt; chromagram = librosa.util.normalize(chromagram, axis=0)</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; plt.subplot(3, 1, 1)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(librosa.amplitude_to_db(CQT,</span>
<span class="sd">    ...                                                  ref=np.max),</span>
<span class="sd">    ...                          y_axis=&#39;cqt_note&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&#39;CQT Power&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.colorbar()</span>
<span class="sd">    &gt;&gt;&gt; plt.subplot(3, 1, 2)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(chromagram, y_axis=&#39;chroma&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&#39;Chroma (wrapped CQT)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.colorbar()</span>
<span class="sd">    &gt;&gt;&gt; plt.subplot(3, 1, 3)</span>
<span class="sd">    &gt;&gt;&gt; chroma = librosa.feature.chroma_stft(y=y, sr=sr)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(chroma, y_axis=&#39;chroma&#39;, x_axis=&#39;time&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&#39;librosa.feature.chroma_stft&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.colorbar()</span>
<span class="sd">    &gt;&gt;&gt; plt.tight_layout()</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># How many fractional bins are we merging?</span>
    <span class="n">n_merge</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bins_per_octave</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_chroma</span>

    <span class="k">if</span> <span class="n">fmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="n">note_to_hz</span><span class="p">(</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">n_merge</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Incompatible CQ merge: &#39;</span>
                             <span class="s1">&#39;input bins must be an &#39;</span>
                             <span class="s1">&#39;integer multiple of output bins.&#39;</span><span class="p">)</span>

    <span class="c1"># Tile the identity to merge fractional bins</span>
    <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n_chroma</span><span class="p">),</span> <span class="n">n_merge</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Roll it left to center on the target bin</span>
    <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">cq_to_ch</span><span class="p">,</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_merge</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># How many octaves are we repeating?</span>
    <span class="n">n_octaves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">n_input</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">)</span>

    <span class="c1"># Repeat and trim</span>
    <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">cq_to_ch</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_octaves</span><span class="p">))[:,</span> <span class="p">:</span><span class="n">n_input</span><span class="p">]</span>

    <span class="c1"># What&#39;s the note number of the first bin in the CQT?</span>
    <span class="c1"># midi uses 12 bins per octave here</span>
    <span class="n">midi_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">hz_to_midi</span><span class="p">(</span><span class="n">fmin</span><span class="p">),</span> <span class="mi">12</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">base_c</span><span class="p">:</span>
        <span class="c1"># rotate to C</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">midi_0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># rotate to A</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">midi_0</span> <span class="o">-</span> <span class="mi">9</span>

    <span class="c1"># Adjust the roll in terms of how many chroma we want out</span>
    <span class="c1"># We need to be careful with rounding here</span>
    <span class="n">roll</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">roll</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_chroma</span> <span class="o">/</span> <span class="mf">12.</span><span class="p">)))</span>

    <span class="c1"># Apply the roll</span>
    <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">cq_to_ch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">cq_to_ch</span><span class="p">,</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">window</span><span class="p">),</span>
                                         <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cq_to_ch</span></div>


<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="window_bandwidth"><a class="viewcode-back" href="../../generated/librosa.filters.window_bandwidth.html#librosa.filters.window_bandwidth">[docs]</a><span class="k">def</span> <span class="nf">window_bandwidth</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get the equivalent noise bandwidth of a window function.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window : callable or string</span>
<span class="sd">        A window function, or the name of a window function.</span>
<span class="sd">        Examples:</span>
<span class="sd">        - scipy.signal.hann</span>
<span class="sd">        - &#39;boxcar&#39;</span>

<span class="sd">    n : int &gt; 0</span>
<span class="sd">        The number of coefficients to use in estimating the</span>
<span class="sd">        window bandwidth</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bandwidth : float</span>
<span class="sd">        The equivalent noise bandwidth (in FFT bins) of the</span>
<span class="sd">        given window function</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    get_window</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">window</span>

    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">WINDOW_BANDWIDTHS</span><span class="p">:</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">WINDOW_BANDWIDTHS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">win</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">win</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">WINDOW_BANDWIDTHS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<div class="viewcode-block" id="get_window"><a class="viewcode-back" href="../../generated/librosa.filters.get_window.html#librosa.filters.get_window">[docs]</a><span class="k">def</span> <span class="nf">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">fftbins</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Compute a window function.</span>

<span class="sd">    This is a wrapper for `scipy.signal.get_window` that additionally</span>
<span class="sd">    supports callable or pre-computed windows.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window : string, tuple, number, callable, or list-like</span>
<span class="sd">        The window specification:</span>

<span class="sd">        - If string, it&#39;s the name of the window function (e.g., `&#39;hann&#39;`)</span>
<span class="sd">        - If tuple, it&#39;s the name of the window function and any parameters</span>
<span class="sd">          (e.g., `(&#39;kaiser&#39;, 4.0)`)</span>
<span class="sd">        - If numeric, it is treated as the beta parameter of the `&#39;kaiser&#39;`</span>
<span class="sd">          window, as in `scipy.signal.get_window`.</span>
<span class="sd">        - If callable, it&#39;s a function that accepts one integer argument</span>
<span class="sd">          (the window length)</span>
<span class="sd">        - If list-like, it&#39;s a pre-computed window of the correct length `Nx`</span>

<span class="sd">    Nx : int &gt; 0</span>
<span class="sd">        The length of the window</span>

<span class="sd">    fftbins : bool, optional</span>
<span class="sd">        If True (default), create a periodic window for use with FFT</span>
<span class="sd">        If False, create a symmetric window for filter design applications.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    get_window : np.ndarray</span>
<span class="sd">        A window of length `Nx` and type `window`</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    scipy.signal.get_window</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParameterError</span>
<span class="sd">        If `window` is supplied as a vector of length != `n_fft`,</span>
<span class="sd">        or is otherwise mis-specified.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">callable</span><span class="p">(</span><span class="n">window</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">window</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">or</span>
          <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">window</span><span class="p">)):</span>
        <span class="c1"># TODO: if we add custom window functions in librosa, call them here</span>

        <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">fftbins</span><span class="o">=</span><span class="n">fftbins</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">==</span> <span class="n">Nx</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Window size mismatch: &#39;</span>
                             <span class="s1">&#39;</span><span class="si">{:d}</span><span class="s1"> != </span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">Nx</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s1">&#39;Invalid window specification: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">window</span><span class="p">))</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013--2017, librosa development team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 0.5.1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../../0.4.0rc1/index.html">0.4.0rc1</a></dd>
            <dd><a href="../../../0.4.0rc2/index.html">0.4.0rc2</a></dd>
            <dd><a href="../../../0.4.1/index.html">0.4.1</a></dd>
            <dd><a href="../../../0.4.1rc0/index.html">0.4.1rc0</a></dd>
            <dd><a href="../../../0.4.2/index.html">0.4.2</a></dd>
            <dd><a href="../../../0.4.3/index.html">0.4.3</a></dd>
            <dd><a href="../../../0.4.3rc0/index.html">0.4.3rc0</a></dd>
            <dd><a href="../../../0.5.0/index.html">0.5.0</a></dd>
            <dd><a href="../../../0.5.0rc0/index.html">0.5.0rc0</a></dd>
            <dd><a href="filters.html">0.5.1</a></dd>
            <dd><a href="../../../0.6.0/index.html">0.6.0</a></dd>
            <dd><a href="../../../0.6.0rc0/index.html">0.6.0rc0</a></dd>
            <dd><a href="../../../0.6.0rc1/index.html">0.6.0rc1</a></dd>
            <dd><a href="../../../v0.1.0/index.html">v0.1.0</a></dd>
            <dd><a href="../../../v0.4.0/index.html">v0.4.0</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../display-bin-centering/index.html">display-bin-centering</a></dd>
            <dd><a href="../../../master/index.html">master</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.5.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>